{"version":3,"sources":["index.tsx"],"names":["ProximiioNative","NativeModules","BufferSize","NotificationMode","NativeAccuracy","ProximiioEvents","Proximiio","NativeEventEmitter","ready","visitorId","location","floor","level","authorize","bind","getContext","subscribe","unsubscribe","state","length","token","authWithToken","PositionUpdated","FloorChanged","currentFloor","currentGeofences","getDepartments","id","getDepartment","getFloor","getFloors","getGeofence","getGeofences","getPlace","getPlaces","buffer","Platform","OS","setBufferSize","useBluetooth","requestPermissions","checkAndRequestBluetooth","isBluetoothEnabled","granted","onPermissionResult","enable","disable","event","fn","emitter","addListener","console","warn","removeListener","mode","setNotificationMode","title","setNotificationTitle","text","setNotificationText","icon","setNotificationIcon","enabled","pdrCorrectionThreshold","setPdr","setSnapToRoute","updateOptions","accuracy","setNativeAccuracy","erase","destroy","instance","ProximiioContext","React","createContext","ProximiioContextProvider","children","context","setContext","contextSetter","positionSub","floorsSub","remove"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, PropsWithChildren } from 'react';\nimport {\n  NativeModules,\n  NativeEventEmitter,\n  Platform,\n  EmitterSubscription,\n} from 'react-native';\nconst { ProximiioNative } = NativeModules;\n\nimport {\n  ProximiioContextType,\n  ProximiioInitState,\n  ProximiioFloor,\n  ProximiioGeofence,\n  ProximiioDepartment,\n  ProximiioPlace,\n  ProximiioLocation,\n} from './types';\n\nexport enum BufferSize {\n  MINI = 0,\n  SMALL = 1,\n  MEDIUM = 2,\n  LARGE = 3,\n  XLARGE = 4,\n}\n\nexport enum NotificationMode {\n  Disabled = 0,\n  Enabled = 1,\n  Required = 2,\n}\n\nexport enum NativeAccuracy {\n  Cellular = 1,\n  WIFI = 2,\n  GPS = 3,\n  Navigation = 4,\n}\n\nexport enum ProximiioEvents {\n  Initialized = 'ProximiioInitialized',\n  PositionUpdated = 'ProximiioPositionUpdated',\n  FloorChanged = 'ProximiioFloorChanged',\n  ItemsChanged = 'ProximiioItemsChanged',\n  EnteredGeofence = 'ProximiioEnteredGeofence',\n  ExitedGeofence = 'ProximiioExitedGeofence',\n  EnteredPrivacyZone = 'ProximiioEnteredPrivacyZone',\n  ExitedPrivacyZone = 'ProximiioExitedPrivacyZone',\n  FoundIBeacon = 'ProximiioFoundIBeacon',\n  UpdatedIBeacon = 'ProximiioUpdatedIBeacon',\n  LostIBeacon = 'ProximiioLostIBeacon',\n  FoundEddystoneBeacon = 'ProximiioFoundEddystoneBeacon',\n  UpdatedEddystoneBeacon = 'ProximiioUpdatedEddystoneBeacon',\n  LostEddystoneBeacon = 'ProximiioLostEddystoneBeacon',\n}\n\nexport class Proximiio {\n  emitter: NativeEventEmitter = new NativeEventEmitter(ProximiioNative);\n  state: ProximiioInitState = {\n    ready: true,\n    visitorId: '',\n  };\n\n  location?: ProximiioLocation;\n  floor?: ProximiioFloor;\n  level = 0;\n\n  constructor() {\n    this.authorize = this.authorize.bind(this);\n    this.getContext = this.getContext.bind(this);\n    this.subscribe = this.subscribe.bind(this);\n    this.unsubscribe = this.unsubscribe.bind(this);\n  }\n\n  isAuthorized() {\n    return this.state.visitorId.length > 0;\n  }\n\n  async authorize(token: string): Promise<ProximiioInitState> {\n    const state = await ProximiioNative.authWithToken(token);\n    this.state.ready = true;\n    this.state.visitorId = state.visitorId;\n    this.subscribe(\n      ProximiioEvents.PositionUpdated,\n      (location: ProximiioLocation) => {\n        this.location = location;\n      }\n    );\n\n    this.subscribe(ProximiioEvents.FloorChanged, (floor?: ProximiioFloor) => {\n      this.floor = floor;\n      this.level = floor?.level || 0;\n    });\n    return state;\n  }\n\n  async currentFloor(): Promise<ProximiioFloor> {\n    return await ProximiioNative.currentFloor();\n  }\n\n  async currentGeofences(): Promise<ProximiioGeofence[]> {\n    return await ProximiioNative.currentGeofences();\n  }\n\n  getContext = () => {\n    return {\n      location: this.location,\n      floor: this.floor,\n      level: this.floor?.level,\n    } as ProximiioContextType;\n  };\n\n  departments(): Promise<ProximiioDepartment[]> {\n    return ProximiioNative.getDepartments();\n  }\n\n  getDepartment(id: string): Promise<ProximiioDepartment> {\n    return ProximiioNative.getDepartment(id);\n  }\n\n  getFloor(id: string): Promise<ProximiioFloor | null> {\n    return ProximiioNative.getFloor(id);\n  }\n\n  floors(): Promise<ProximiioFloor[]> {\n    return ProximiioNative.getFloors();\n  }\n\n  getGeofence(id: string): Promise<ProximiioGeofence | null> {\n    return ProximiioNative.getGeofence(id);\n  }\n\n  geofences(): Promise<ProximiioGeofence[]> {\n    return ProximiioNative.getGeofences();\n  }\n\n  getPlace(id: string): Promise<ProximiioPlace | null> {\n    return ProximiioNative.getPlace(id);\n  }\n\n  places(): Promise<ProximiioPlace[]> {\n    return ProximiioNative.getPlaces();\n  }\n\n  setBufferSize(buffer: BufferSize) {\n    if (Platform.OS === 'ios') {\n      ProximiioNative.setBufferSize(buffer);\n    }\n  }\n\n  requestPermissions(useBluetooth: boolean = true) {\n    ProximiioNative.requestPermissions(false, useBluetooth);\n  }\n\n  checkAndRequestBluetooth(): Promise<void> {\n    return ProximiioNative.checkAndRequestBluetooth()\n  }\n\n  isBluetoothEnabled(): Promise<boolean> {\n    return ProximiioNative.isBluetoothEnabled()\n  }\n\n  onPermissionResult(granted: boolean) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.onPermissionResult(granted ? 1 : 0);\n    }\n  }\n\n  enable() {\n    ProximiioNative.enable();\n  }\n\n  disable() {\n    ProximiioNative.disable();\n  }\n\n  subscribe(\n    event: string,\n    fn: (data: any) => void\n  ): EmitterSubscription | undefined {\n    if (event) {\n      return this.emitter.addListener(event, fn);\n    } else {\n      return;\n      // console.warn(`ignored native emitter subscribe request, event: ${event}, fn: ${fn.toString()}`);\n    }\n  }\n\n  unsubscribe(event: string, fn: (data: any) => void): any {\n    console.warn(\n      'Unsubscribe method is being deprecated, please use remove() on the subscription'\n    );\n\n    if (event) {\n      return this.emitter.removeListener(event, fn);\n    } else {\n      // console.warn(`ignored native emitter unsubscribe request, event: ${event}, fn: ${fn.toString()}`);\n    }\n  }\n\n  setNotificationMode(mode: NotificationMode) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.setNotificationMode(mode);\n    }\n  }\n\n  setNotificationTitle(title: string) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.setNotificationTitle(title);\n    }\n  }\n\n  setNotificationText(text: string) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.setNotificationText(text);\n    }\n  }\n\n  setNotificationIcon(icon: string) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.setNotificationIcon(icon);\n    }\n  }\n\n  setPdr(enabled: boolean, pdrCorrectionThreshold: number) {\n    ProximiioNative.setPdr(enabled, pdrCorrectionThreshold);\n  }\n\n  setSnapToRoute(enabled: boolean, pdrCorrectionThreshold: number) {\n    ProximiioNative.setSnapToRoute(enabled, pdrCorrectionThreshold);\n  }\n\n  updateOptions() {\n    if (Platform.OS === 'android') {\n      ProximiioNative.updateOptions();\n    }\n  }\n\n  setNativeAccuracy(accuracy: NativeAccuracy) {\n    ProximiioNative.setNativeAccuracy(accuracy);\n  }\n\n  destroy(erase: boolean) {\n    if (Platform.OS === 'android') {\n      ProximiioNative.destroy(erase);\n    } else {\n      ProximiioNative.destroy();\n    }\n  }\n}\n\nconst instance = new Proximiio();\nexport default instance;\n\nexport {\n  ProximiioContextType,\n  ProximiioInitState,\n  ProximiioFloor,\n  ProximiioGeofence,\n  ProximiioDepartment,\n  ProximiioPlace,\n  ProximiioLocation,\n};\n\nexport const ProximiioContext = React.createContext(instance.getContext());\n\nexport const ProximiioContextProvider = ({\n  children,\n}: PropsWithChildren<{}>) => {\n  const [context, setContext] = useState({} as ProximiioContextType);\n\n  useEffect(() => {\n    const contextSetter = () => {\n      setContext(instance.getContext());\n    };\n\n    const positionSub = instance.subscribe(\n      ProximiioEvents.PositionUpdated,\n      contextSetter\n    );\n    const floorsSub = instance.subscribe(\n      ProximiioEvents.FloorChanged,\n      contextSetter\n    );\n\n    return () => {\n      positionSub?.remove();\n      floorsSub?.remove();\n    };\n  }, []);\n\n  return (\n    <ProximiioContext.Provider value={context}>\n      {children}\n    </ProximiioContext.Provider>\n  );\n};\n"]}